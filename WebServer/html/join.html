<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>회원가입</title>
    <style media="screen">
        #divClock{
            font-size: 12px;
            color: rgb(255, 255, 255);
        }
        body {
            background: #131722!important;
            color: #fff!important;
        }
        body > .grid {
            height: 100%;
        }
        .image {
            margin-top: -100px;
        }
        .column {
            max-width: 450px;
        }
        .colorWhite {
            color : white!important;
        }
        .ui.blue.button {
            background-color: #0061ff!important;
            color: #FFFFFF;
            text-shadow: none;
            background-image: none;
        }
        .ui.inverted.button {
            box-shadow: 0px 0px 0px 1px #FFFFFF inset !important;
            background: transparent none;
            color: #FFFFFF;
            text-shadow: none !important;
        }
        </style>
    <link rel="stylesheet" type="text/css" href="asset/css/semantic.css">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script src="asset/js/semantic.js"></script>
    <script type="text/javascript">


      window.addEventListener('DOMContentLoaded', function()
      {
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //REGEX;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //DOM element;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        window.el = {};
        window.el.input = {};
        window.el.input.email = window.document.getElementById("inputEmail");
        window.el.input.password = window.document.getElementById("inputPassword");

        window.el.btn = {}
        window.el.btn.login = window.document.getElementById("btnLogin");
        window.el.btn.join = window.document.getElementById("btnJoin");


        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //Functions;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        var webStorageSetItem = function( o ){
          console.log( "[S] - webStorageSetItem ")
          var s,so;
          for( s in o ){
            so = o[ s ];
            console.log( s );
            window.localStorage.setItem( s , so );
          }
          console.log( "[E] - webStorageSetItem ")
        }
        /* 
    	[요약 설명]
    	1. XMLHttpRequest : 비동기식 통신 방식 객체이며, 서버와 데이터를 교환할 때 사용됩니다
    	2. xhr.open : 서버로 보낼 Ajax 요청의 형식을 설정합니다
    	3. xhr.send : Ajax 요청을 서버로 전달합니다
    	
    	4. xhr.onreadystatechange : XMLHttpRequest 객체의 현재 상태를 나타냅니다    	
    	5. readyState 프로퍼티 : 
    		- UNSENT (숫자 0) : XMLHttpRequest 객체가 생성됨
    		- OPENED (숫자 1) : open() 메소드가 성공적으로 실행됨
    		- HEADERS_RECEIVED (숫자 2) : 모든 요청에 대한 응답이 도착함
    		- LOADING (숫자 3) : 요청한 데이터를 처리 중
    		- DONE (숫자 4) : 요청한 데이터의 처리가 완료되어 응답할 준비가 완료됨
    		
    	6. xhr.status : 서버로부터 응답받은 상태 및 리턴 메시지를 확인합니다
    	7. status 프로퍼티 :
    		- 200 ~ 201 : 요청이 성공적 상태
    		- 그외 상태 : 인터넷에서 http 응답 상태를 검색해서 확인
    	*/

    	
    	
    	/* 이벤트 함수 정의 */
    	function requestGet(){
    		console.log("");
    		console.log("[requestGet] : [start]");    		
    		console.log("");
    		
    		// url 및 전송 데이터 선언
    		var url = "http://jsonplaceholder.typicode.com/posts?userId=1&id=1";
    		    		    		    		
    		// XMLHttpRequest 객체 생성 및 요청 수행
    		var xhr = new XMLHttpRequest();
    		xhr.open("GET", url, true);
    		    		
    		console.log("[request url] : " + url);    		    	
    		console.log("[request method] : " + "GET");
    		console.log("");
    		
    		//xhr.onreadystatechange = CallbackFunction; //콜백 함수 지정해서 처리 가능    		
    		xhr.onreadystatechange = function() {
    			if (xhr.readyState == 4) { 
    				if (xhr.status == 200 || xhr.status == 201){
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[success]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");        				
    				}
    				else {
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[fail]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");        				
    				}					
    			}    			
    		}
    		xhr.send(null); //get 쿼리 파람 방식일때 null    					    		    		
									
    	};

    	
    	
    	/* 이벤트 함수 정의 */
    	function requestPost(){
    		console.log("");
    		console.log("[requestPost] : [start]");    		
    		console.log("");
    		
    		// url 및 전송 데이터 선언
    		var url = "http://jsonplaceholder.typicode.com/posts?userId=1&id=1";
    		    		    		    		
    		// XMLHttpRequest 객체 생성 및 요청 수행
    		var xhr = new XMLHttpRequest();
    		xhr.open("POST", url, true);
    		    		
    		console.log("[request url] : " + url);    		    	
    		console.log("[request method] : " + "POST");
    		console.log("");
    		
    		//xhr.onreadystatechange = CallbackFunction; //콜백 함수 지정해서 처리 가능    		
    		xhr.onreadystatechange = function() {
    			if (xhr.readyState == 4) {
    				if (xhr.status == 200 || xhr.status == 201){
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[success]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");        				
    				}
    				else {
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[fail]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");        				
    				}    				
    			}    			
    		}
    		xhr.send(null); //post 쿼리 파람 방식일때 null    					    		    		
									
    	};

    	
    	
    	/* 이벤트 함수 정의 */
    	function requestPostBodyJson( url, data, cbFunction ){
    		debugger;
        console.log("");
    		console.log("[requestPostBodyJson] : [start]");    		
    		console.log("");
    		
    		// url 및 전송 데이터 선언
    		//var url = "http://jsonplaceholder.typicode.com/posts";
    		
    		// 전송 json 데이터 선언
    		var jsonData = data//{"userId" : 1 , "id" : 1};
    		    		    		    		debugger;
    		// XMLHttpRequest 객체 생성 및 요청 수행
    		var xhr = new XMLHttpRequest();
    		xhr.open("POST", url, true);
    		    		
    		console.log("[request url] : " + url);
    		console.log("[request data] : " + JSON.stringify(jsonData));
    		console.log("[request method] : " + "POST");
    		console.log("");
    		
    		//xhr.onreadystatechange = CallbackFunction; //콜백 함수 지정해서 처리 가능    		
    		xhr.onreadystatechange = function() {
    			if (xhr.readyState == 4) {
    				if (xhr.status == 200 || xhr.status == 201){
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[success]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");
              cbFunction( xhr.responseText )        				
    				}
    				else {
    					console.log("[status] : " + xhr.status);
    					console.log("[response] : " + "[fail]");    				   				    				
    					console.log("[response] : " + xhr.responseText);
    					console.log("");        				 
    				}						    				
    			}    			
    		}
    		xhr.setRequestHeader("Content-Type", "application/json");    		
    		xhr.send(JSON.stringify(jsonData)); //post body json 방식 일때    					    		    		
									
    	};

        function showClock(){
          var currentDate = new Date();
          var divClock = document.getElementById('divClock');
          var msg = "현재 시간 : ";
          if(currentDate.getHours()>12){      //시간이 12보다 크다면 오후 아니면 오전
            msg += "오후 ";
            msg += currentDate.getHours()-12+"시 ";
        }
        else {
          msg += "오전 ";
          msg += currentDate.getHours()+"시 ";
        }
  
          msg += currentDate.getMinutes()+"분 ";
          msg += currentDate.getSeconds()+"초";
  
          divClock.innerText = msg;
  
          if (currentDate.getMinutes()>58) {    //정각 1분전부터 빨강색으로 출력
            divClock.style.color="red";
          }
          setTimeout(showClock,1000);  //1초마다 갱신
        }
        
        showClock();

        var checkEmail = function(str){
          let regex = new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)          
          console.log(regex.test(str));

          return regex.test(str)
          
        }
        
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //Event;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        window.evt = {}
        window.evt.btnLoginClick = window.el.btn.login.addEventListener("click",function(evt){
      
          

          var email = window.el.input.email.value;
          var password = window.el.input.password.value;

          console.log( "email : ", email );
          console.log( "password : ", password );

          if( email == "" ){
            return alert("이메일을 입력해주세요")
          }
          else
          {
            if( !checkEmail( email ) ){
              return alert("이메일형식이 잘못되었습니다.")
            }
          }

          if( password == "" ){
            return alert("비밀번호를 입력해주세요")
          }
          //window.el.btn.login.textContent = ""
          window.el.btn.join.classList.add("loading");
          
          console.log( "window.el.btn.login - click!" );

          var postBody = { email : email, pass : password }
          requestPostBodyJson('/api/join',postBody , function( d ){
            console.log( "===========" )
            console.log( "===========" )
            console.log( "===========" )
            console.log( "===========" )
            var _d = JSON.parse( d );
            webStorageSetItem( JSON.parse( _d.d ) )
            location.href="/"

          })

         })             
        window.evt.btnJoinClick = window.el.btn.join.addEventListener("click",function(evt){
          console.log( "window.el.btn.join - click!" )
          window.location.href = "/html/login.html"
        })      
      });
      
    </script>
  </head>
  <body>
    
    <div class="ui middle aligned center aligned grid">
      <div class="column">
        <h2 class="ui image header">
          <div class="content">
            <!-- <div>🔑</div> -->
            <div class="colorWhite">이메일로 회원가입</div>
            <div id="divClock" class="clock"></div>
          </div>
        </h2>
        <!-- <form class="ui large form"> -->
         
            <div class="field" style="margin-bottom: 20px;">
              <div class="ui fluid action input">
                <input id="inputEmail" type="text" name="email" placeholder="이메일">
                <button class="ui button">인증</button>
            
              </div>
              </div>

            <div class="field" style="margin-bottom: 20px;">
              <div class="ui fluid input">
                <input id="inputPassword" type="password" name="password" placeholder="비밀번호">
              </div>
            </div>

            <div class="field" style="margin-bottom: 20px;">
              <div class="ui fluid input">
                <input id="inputPasswordCheck" type="password" name="password" placeholder="비밀번호확인">
              </div>
            </div>

            <div id="btnLogin" class="ui fluid large blue submit button">어카운트 만들기</div>
    
    
          <!--div class="ui error message"></div-->
    
        
            <div class="ui horizontal divider colorWhite" style="margin-top: 40px;">
                광고성메일 수신동의
            </div>

            <div style="margin-bottom: 10px;">
                <div class="field">
                    <div class="ui checkbox">
                        <input type="checkbox" tabindex="0">
                        <label class="colorWhite">새 기능, 이벤트 홍보, 대회 안내 등의 알림 수신 (선택)</label>
                    </div>
                </div>
                <div style="font-size: 0.8rem">이용약관의 변경이나 관계 법령에 따라 회원님께 안내되어야 할 중요 고지 사항은 메일 수신 동의 여부에 상관 없이 안내될 수 있습니다.</div>
            </div>
          
            <div class="ui horizontal divider colorWhite">
              서비스 이용약관 및 개인정보처리방침 동의
            </div>

            <div style="margin-bottom: 10px;">
              <div class="field">
                  <div class="ui checkbox">
                      <input type="checkbox" tabindex="0">
                      <label class="colorWhite">회원가입 시 서비스 약관 및 개인정보 처리방침을 확인하였으며, 동의합니다. (필수)</label>
                  </div>
              </div>
              <div style="font-size: 0.8rem">이용약관의 변경이나 관계 법령에 따라 회원님께 안내되어야 할 중요 고지 사항은 메일 수신 동의 여부에 상관 없이 안내될 수 있습니다.</div>
            </div>
          

        <!-- </form> -->
        <div id="btnJoin" class="ui message">
          이미 어카운트가 있나요? <a href="#">Sign In</a>
        </div>
        <div class="ui divider">
        </div>
        <div>
          
        </div>
      </div>
    </div>
  </body>
</html>
