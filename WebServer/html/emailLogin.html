<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
    <style media="screen">
      #divClock{
        font-size: 12px;
        color: rgb(255, 255, 255);
      }
      body {
        background: #131722!important;
        color: #fff!important;
      }
      body > .grid {
        height: 100%;
      }
      .image {
        margin-top: -100px;
      }
      .column {
        max-width: 450px;
      }
      .colorWhite {
        color : white!important;
      }
      .ui.blue.button {
        background-color: #0061ff!important;
        color: #FFFFFF;
        text-shadow: none;
        background-image: none;
      }
     .inputerror {
      border-color: red!important;
      /* background: border-box; */
      box-shadow: 0 0 10px #d6a8e9!important;
      outline: none!important;
      border-width: thin!important;
     }
     .displayNone {
      display: none!important;
     }
     .displayBlock {
      display: block!important;
     }
    </style>
    <link rel="stylesheet" type="text/css" href="asset/css/semantic.css">
    <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
    <script src="asset/js/semantic.js"></script>
    <script src="asset/js/util.js"></script>
    <script type="text/javascript">


      window.addEventListener('DOMContentLoaded', function()
      {
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //REGEX;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //DOM element;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        window.el = {};
        window.el.input = {};
        window.el.input.email = window.document.getElementById("inputEmail");
        window.el.input.password = window.document.getElementById("inputPassword");

        window.el.btn = {}
        window.el.btn.login = window.document.getElementById("btnLogin");
        window.el.btn.join = window.document.getElementById("btnJoin");
        window.el.btn.showPassBt = window.document.getElementById("showPassBt");
        window.el.btn.hidePassBt = window.document.getElementById("hidePassBt");

        window.el.div = {}
        window.el.div.emailTooltip = window.document.getElementById("toolipEmail");

        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //Functions;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        var webStorageSetItem = function( o ){
          console.log( "[S] - webStorageSetItem ")
          var s,so;
          for( s in o ){
            so = o[ s ];
            console.log( s );
            window.localStorage.setItem( s , so );
          }
          console.log( "[E] - webStorageSetItem ")
        }


        function showClock(){
          var currentDate = new Date();
          var divClock = document.getElementById('divClock');
          var msg = "현재 시간 : ";
          if(currentDate.getHours()>12){      //시간이 12보다 크다면 오후 아니면 오전
            msg += "오후 ";
            msg += currentDate.getHours()-12+"시 ";
        }
        else {
          msg += "오전 ";
          msg += currentDate.getHours()+"시 ";
        }
  
          msg += currentDate.getMinutes()+"분 ";
          msg += currentDate.getSeconds()+"초";
  
          divClock.innerText = msg;
  
          if (currentDate.getMinutes()>58) {    //정각 1분전부터 빨강색으로 출력
            divClock.style.color="red";
          }
          setTimeout(showClock,1000);  //1초마다 갱신
        }
        
        showClock();

        var checkEmail = function(str){
          let regex = new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)          
          console.log(regex.test(str));

          return regex.test(str)
          
        }
        var checkPass = function(str){

          let regex = new RegExp(/^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/)          
          console.log(regex.test(str));

          //*/
          return true;
          /*/
          return regex.test(str)
          //*/
        }

        var loginBtCheck = function(){
          var checkEmailInputData = window.el.input.email.attributes[ "data-validate" ].value
          var checkPassInputData = window.el.input.password.attributes[ "data-validate" ].value
          if( checkEmailInputData != "false" && checkPassInputData != "false" )
          {
            window.el.btn.login.classList.remove( "disabled" );
          }
          else
          {
            window.el.btn.login.classList.add( "disabled" );
          }
        }
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //Event;
        //-------------------------------------------------------;
        //-------------------------------------------------------;
        //-------------------------------------------------------;

        window.evt = {}
        window.el.input.password.addEventListener("keypress",function(evt){
          
          //var emailInputLoader = window.document.getElementById("emailInputLoader");
          var pass = evt.target.value;
          var checkEmailInputData = window.el.input.email.attributes[ "data-validate" ].value
          var checkPassInputData = window.el.input.password.attributes[ "data-validate" ].value

          if( checkPass(pass) )
          {
            window.el.input.password.attributes[ "data-validate" ].value = "true";
          }
          else
          {
            window.el.input.password.attributes[ "data-validate" ].value = "false";
          }
          loginBtCheck();
        })

        window.el.input.email.addEventListener("change",function(evt){
          
          var emailInputLoader = window.document.getElementById("emailInputLoader");
          var email = evt.target.value;
          
          var checkEmailInputData = window.el.input.email.attributes[ "data-validate" ].value
          var checkPassInputData = window.el.input.password.attributes[ "data-validate" ].value


          emailInputLoader.classList.remove("displayNone");

          if( !checkEmail(email) )
          {
            evt.target.classList.add( "inputerror" );
            window.el.div.emailTooltip.classList.remove( "displayNone" );
            emailInputLoader.classList.add("displayNone");
            window.el.input.email.attributes[ "data-validate" ].value = "false";
            return;
            //return alert("이메일을 입력해주세요");

          }
          else
          {
            if( !window.el.div.emailTooltip.classList.contains( "displayNone" ) ) window.el.div.emailTooltip.classList.add( "displayNone" );
            evt.target.classList.remove( "inputerror" );
            // emailInputLoader.classList.add("displayNone");
            requestGet("/api/existEmail?email=" + email, function(d){
              var r = JSON.parse(d)
              if( !r.r )
              {
                console.log( "email exist : " + r.userId )
                emailInputLoader.classList.add("displayNone");
                window.el.input.email.attributes[ "data-validate" ].value = "true";
              }
              else
              {
                window.el.div.emailTooltip.classList.remove( "displayNone" );
                emailInputLoader.classList.add("displayNone");
                evt.target.classList.add( "inputerror" );
                window.el.div.emailTooltip.innerText = "존재하지 않는 이메일입니다.!"
                console.log( "email exist : " + r.m )
                window.el.input.email.attributes[ "data-validate" ].value = "false";
              }
              loginBtCheck();
            })
          }

        });
        window.evt.btnLoginClick = window.el.btn.login.addEventListener("click",function(evt){

          var email = window.el.input.email.value;
          var password = window.el.input.password.value;

          console.log( "email : ", email );
          console.log( "password : ", password );

          if( email == "" ){
            return alert("이메일을 입력해주세요")
          }
          else
          {
            if( !checkEmail( email ) ){
              return alert("이메일형식이 잘못되었습니다.")
            }
          }

          if( password == "" ){
            return alert("비밀번호를 입력해주세요")
          }
          //window.el.btn.login.textContent = ""
          window.el.btn.login.classList.add("loading");
          
          console.log( "window.el.btn.login - click!" );

          var postBody = { email : email, pass : password }
          requestPostBodyJson('/api/login',postBody , function( d ){
            var _d = JSON.parse( d );
            if( _d.r == 1 )
            {
              window.el.btn.login.classList.remove("loading");
              alert("패스워드를 확인해주세요");
            }
            else
            {
              debugger;
              var userInfo = JSON.parse( _d.d );
              
              webStorageSetItem( userInfo );
              location.href="/"
            }
            
          })

        })        
        window.evt.btnJoinClick = window.el.btn.join.addEventListener("click",function(evt){
          console.log( "window.el.btn.join - click!" )
          window.location.href = "/html/join.html"
        })
        //툴팁달기 https://sisiblog.tistory.com/336;
        window.el.btn.showPassBt.addEventListener("click",function(evt){
          window.el.btn.hidePassBt.classList.remove("displayNone");
          window.el.btn.showPassBt.classList.add("displayNone");
          window.el.input.password.type = "text";
        })
        window.el.btn.hidePassBt.addEventListener("click",function(evt){
          window.el.btn.hidePassBt.classList.add("displayNone");
          window.el.btn.showPassBt.classList.remove("displayNone");
          window.el.input.password.type = "password";
        })
        
      });
      
    </script>
  </head>
  <body>
    
    <div class="ui middle aligned center aligned grid">
      <div class="column">
        <h2 class="ui image header">
          <div class="content">
            <!-- <div>🔑</div> -->
            <div class="colorWhite">이메일로 로그인</div>
            <div id="divClock" class="clock"></div>
          </div>
        </h2>
        <form class="ui large form">
         
            <div class="field">
              <div class="ui icon input loading">
                <input id="inputEmail" data-validate="false" type="text" name="email" placeholder="이메일">
                <i id="emailInputLoader" class="search icon displayNone"></i>
              </div>
              <div id="toolipEmail" class="ui pointing red basic label displayNone">
                잘못된형식의 이메일입니다.
              </div>
              <div class="ui tiny error message">잘못된형식의 이메일입니다.</div>
            </div>
            <div class="field">
              <div class="ui icon input">
                <input id="inputPassword" data-validate="false" type="password" name="password" placeholder="비밀번호">
                <div id="showPassBt" class="" style="position: absolute;right: 7px;top: 6px;cursor: pointer;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M21.8 9.92C20.09 7.99 17.46 6 14 6S7.92 8 6.2 9.92A17.7 17.7 0 0 0 3.44 14a18.56 18.56 0 0 0 2.74 4.08C7.92 20.01 10.55 22 14 22c3.45 0 6.08-2 7.8-3.92 1.11-1.22 2.03-2.6 2.75-4.08a17.82 17.82 0 0 0-2.74-4.08ZM14 21c-3.05 0-5.42-1.76-7.07-3.58A17.13 17.13 0 0 1 4.56 14c.27-.53 1.08-1.98 2.37-3.42C8.58 8.76 10.95 7 14 7c3.05 0 5.42 1.76 7.07 3.58 1.29 1.44 2.1 2.89 2.37 3.42-.27.53-1.08 1.98-2.37 3.42C19.42 19.24 17.05 21 14 21Z"></path><path fill="currentColor" fill-rule="evenodd" d="M10 14a4 4 0 1 1 8 0 4 4 0 0 1-8 0Zm1 0a3 3 0 1 1 6 0 3 3 0 0 1-6 0Z"></path></svg>
                </div>
                <div id="hidePassBt"  class="displayNone" style="position: absolute;right: 7px;top: 6px;cursor: pointer;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M22.2 6.5 6.5 22.2l-.7-.7L21.5 5.8l.7.7ZM14 6c1.54 0 2.9.4 4.1 1l-.74.75A8 8 0 0 0 14 7c-3.05 0-5.42 1.76-7.07 3.59A17.13 17.13 0 0 0 4.56 14a17.13 17.13 0 0 0 2.77 3.84l-.7.7-.44-.45c-1.1-1.24-2-2.61-2.74-4.09a17.7 17.7 0 0 1 2.74-4.08C7.92 7.99 10.55 6 14 6ZM21.8 9.92l-.41-.45-.7.7.38.42c1.29 1.43 2.1 2.88 2.37 3.41-.27.53-1.08 1.98-2.37 3.42C19.42 19.24 17.05 21 14 21a7.99 7.99 0 0 1-3.35-.75L9.9 21c1.2.6 2.57 1 4.1 1 3.45 0 6.08-2 7.8-3.91 1.11-1.23 2.03-2.6 2.75-4.09a17.82 17.82 0 0 0-2.74-4.08Z"></path><path fill="currentColor" d="M13.01 17.88A4 4 0 0 0 17.87 13l-.87.87V14a3 3 0 0 1-3.11 3l-.88.88ZM10.13 15.02l.87-.88V14a3 3 0 0 1 3.13-3l.87-.87a4 4 0 0 0-4.87 4.89Z"></path></svg>
                </div>
              </div>
            </div>
            <div id="btnLogin" class="ui fluid large blue submit button disabled">로그인</div>
    
    
          <div class="ui error message"></div>
    
        </form>
        <div style="font-size: 0.8rem;margin-top: 15px;">
          회원가입시 등록한 이메일로 로그인합니다.
        </div>
        <div id="btnJoin" class="ui message">
          어카운트가 없나요? <a href="#">Sign Up</a>
        </div>

      </div>
    </div>
  </body>
</html>
